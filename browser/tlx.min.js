(function(){"use strict";var e,t,n;if(typeof window==="undefined"){e=require("jsdom").JSDOM;t=new e(``).window;n=(e=>e())}else{t=window;n=t.requestAnimationFrame}var r=t.document;function i(e,t,n,o,a=t){Object.defineProperty(t,"view",{enumerable:false,configurable:true,writable:true,value:a});const s={};if(typeof e==="string"&&t.nodeName==="#text"){let r;while(true){try{r=Function("model={}","actions={}","extras={}","with(model) { with(actions) { with(extras) { return `"+e+"`}}}")(n,o,s);break}catch(e){const t=c(e);if(!t)throw e;n[t];s[t]=""}}if(t.data!==r)t.data=r;return}if(e.tagName!==t.tagName){!t.parentNode||t.parentNode.replaceChild(w(e),t);return}[].slice.call(t.attributes).forEach(n=>{if(e.attributes[n.name]==null)t.removeAttribute(n.name)});let l;Object.keys(e.attributes).forEach(f=>{let d=e.attributes[f],p=typeof d;const h=d[0]==="$"&&d[1]==="{"&&d[d.length-1]==="}",m=C[f]||j.directives[f];if(m)l=true;if(p==="string"){while(true){try{if(h){d=Function("model={}","actions={}","extras={}","__interpolate","with(model) { with(actions) { with(extras) { return __interpolate`"+d+"`[0]}}}")(n,o,s,u)}else{d=Function("model={}","actions={}","extras={}","with(model) { with(actions) { with(extras) { return `"+d+"`}}}")(n,o,s)}p=typeof d;break}catch(e){const t=c(e);if(!t)throw e;n[t];s[t]=""}}}if(d==null){t.removeAttribute(f);delete t[f]}else if(["boolean","number","string"].includes(p)){if(d!==t.getAttribute(f))t.setAttribute(f,d)}else if(d!==t[f]){t[f]=d}if(m){while(t.lastChild)t.removeChild(t.lastChild);const s=(n,o)=>{e.children.forEach(e=>{if(typeof e==="string"){t.appendChild(new Text(e))}else{t.appendChild(r.createElement(e.tagName))}i(e,t.lastChild,n,o,a)});return t};const l=m(d,n,o,s),c=typeof l;if(!l){t.parentElement.removeChild(t)}else if(c==="string"){t.innerHTML=l}else if(c==="object"&&l!==t){t.parentElement.replaceNode(l,t)}}});if(!l){let s=t.childNodes.length-e.children.length;while(s-- >0){!t.lastChild||t.removeChild(t.lastChild)}let l=[].slice.call(t.childNodes,0,e.children.length);if(l.length===0){const n=t.shadowRoot;if(n)l=[].slice.call(n.childNodes,0,e.children.length)}e.children.forEach((e,s)=>{if(s<l.length){i(e,l[s],n,o,a);return}if(typeof e==="string"){t.appendChild(new Text(e))}else{t.appendChild(r.createElement(e.tagName))}i(e,t.lastChild,n,o,a)})}}function o(){}o.prototype=new Function;let a,s;const l=new Map,c=e=>{const t=e.message.indexOf("not defined");if(t>=0){const t=e.message.split(" ")[0];try{return Function(`return ${t}`)()}catch(e){return t}}},u=(e,...t)=>t,f=(e,...t)=>{if(Array.isArray(e)){e=e.reduce((n,r,i)=>n+=r+(i<e.length-1?t[i]:""),"")}return Function("model={}","actions={}","extras={}","with(model) { with(actions) { with(extras) { return `"+e+"`}}}")},d=(e,t)=>{t=Object.assign(e,t);Object.keys(t).forEach(n=>{if(typeof t[n]==="undefined"){delete e[n];delete t[n]}});return e},p=(e={},t={})=>{Object.keys(e).forEach(n=>{if(e[n]&&typeof e[n]==="object")p(e[n],t[n])});const n=new Proxy(e,{get(e,t){if(a){let n=l.get(e);if(!n){n={};l.set(e,n)}n[t]||(n[t]=new Set);n[t].add(a)}return e[t]},set(e,r,i){const o=t[r]||t["*"],a=e[r];if(a===i)return true;if(o){const e=Array.isArray(o)?o:[o];e.forEach(e=>t[r](a,i,r,n))}e[r]=i;const s=l.get(e);if(s&&s[r]){s[r].forEach(e=>{if(e.parentElement&&e.render)e.render();else s[r].delete(e)})}return true}});return n},h=e=>{return t=>{const n=e[t.type]||e["*"];if(n)n(t)}},m=(e,t={})=>{let{template:n,customElement:i,model:a,attributes:s,actions:l,controller:c,linkModel:u,reactive:f,lifecycle:p={},protect:h}=t;if(n&&i)throw new Error("Component can only take a template or customElement, not both");if(!n&&!i)throw new Error("Component must have either a template or customElement");if(!i){const t=e.split("-").map(e=>`${e[0].toUpperCase()+e.substring(1)}`).join("");i=Function("template",`return class ${t} extends HTMLElement {\n\t\t\t\t\tconstructor() {\n\t\t\t\t\tsuper();\n\t\t\t\t\tconst shadow = this.attachShadow({mode: 'open'});\n\t\t\t\t\tshadow.innerHTML = template.innerHTML||template;\n\t\t\t\t}}`)(n)}customElements.define(e,i,t.extends?{extends:t.extends}:undefined);const m=new o,b=function(t={}){const n=r.createElement(e),i=Object.assign({controller:c,linkModel:u,lifecycle:p,protect:h},t);i.model=d(JSON.parse(JSON.stringify(a||{})),t.model);i.attributes=d(Object.assign({},s),t.attributes);i.actions=d(Object.assign({},l),t.actions);if(p.beforeCreate)p.beforeCreate.call(n);j.view(n,i);if(p.created)p.created.call(n);return n};b.constructor=o;Object.setPrototypeOf(b,m);return b},b=e=>{function t(t){Object.defineProperty(t,"stopRoute",{enumerable:false,configurable:true,writable:true,value:function(){this.routeStopped=true}});const n=t.target.href;if(n){const n=t.target,r=n.getAttribute("target")||n.view;let i=n.pathname.substring(1);if(n.protocol==="file:")i=i.substring(i.indexOf(":")+2);for(let n in e){const r=e[n];try{n=Function("return "+n)()}catch(e){}const o=typeof n,a={};if(o==="string"){const e=n.split("/"),t=i.split("/");if(e.length!==t.length)continue;if(!e.every((e,n)=>{if(e[0]===":"){a[e.substring(1)]=t[n];return true}return e===t[n]})){continue}}if(o==="string"||o==="function"&&n(i)||n.match(i)){r.call(t,a);t.preventDefault();if(t.routeStopped)break}}}}Object.defineProperty(t,"add",{enumerable:false,configurable:true,writable:true,value:(t,n)=>e[t]=n});e=Object.assign({},e);return t},g=(e,t,n=e.tagName)=>{if(e.nodeName==="#text")return e.textContent;const r={tagName:n,attributes:Object.assign({},t),children:[]};[].slice.call(e.attributes).forEach(e=>{r.attributes[e.name]=e.value});for(const t in e){if(t[0]==="o"&&t[1]==="n"&&typeof e[t]==="function"){r.attributes[t]=e[t]}}[].slice.call(e.childNodes).forEach(e=>{r.children.push(g(e))});return r},w=e=>{if(typeof e==="string"){return new Text(e)}const t=r.createElement(e.tagName);Object.keys(e.attributes).forEach(n=>{const r=e.attributes[n];if(r!=null&&typeof r!=="string"){t[n]=r}else{t.setAttribute(n,r)}});e.children.forEach(e=>{t.appendChild(w(e))});return t},y=(e,{template:n,model:o={},attributes:l={},actions:c={},controller:u,linkModel:f,lifecycle:p={},protect:h=s}={})=>{if(n){const t=typeof n;if(t==="object"){if(n.tagName==="TEMPLATE")n.innerText=n.innerHTML;Object.assign([].slice.call(n.attributes).reduce((e,t)=>{e[t.name]=t.value;return e},{}),l);n=n.shadowRoot?n.shadowRoot:n}else{const t=r.createElement(e.tagName),i=new Text(n);if(t.shadowRoot){while(t.shadowRoot.lastChild)t.shadowRoot.removeChild(t.shadowRoot.lastChild);t.shadowRoot.appendChild(i)}else{t.appendChild(i)}n=t}}const m=g(n||e,l,n&&n.tagName==="TEMPLATE"?e.tagName:undefined);let b;const w=(e,...t)=>{return n=>{const i=e.split(".");let a=i.pop(),s,l=o;while(s=i.shift()){l=l[s];if(!l){l[s]={}}}l[a]=n.target.value;t.forEach(e=>r.querySelectorAll(e).forEach(e=>!e.render||e.render()))}},y=(t=o,n)=>{if(j.off||!e.parentElement)return;const r=a;if(n)t=d(o,t);else if(t!==o)Object.assign(o,t);a=e;if(b&&p.beforeUpdate)p.beforeUpdate.call(e);i(m,e,o,c);a=r;if(b&&p.updated)p.updated.call(e);return e};if(p.beforeMount)p.beforeMount.call(e);y(o);b=true;if(p.mounted)p.mounted.call(e);if(u){let{handleEvent:t,events:n,options:r=false}=u;if(typeof u==="function")t=u;if(n){n.forEach(n=>e.addEventListener(n,t,r))}else{for(const t in e){if(t[0]==="o"&&t[1]==="n")e.addEventListener(t.substring(2),u,r)}}}const E=[].slice.call(e.querySelectorAll("input"));if(e instanceof t.HTMLInputElement)E.push(e);E.forEach(e=>{if(h||e.hasAttribute("protect")){const t=e.setAttribute;let n=e.getAttribute("value");if(n[0]==="$"&&n[1]==="{"&&n[n.length-1]==="}"){n=""}e.setAttribute=function(r,i){if((h||this.hasAttribute("protect"))&&r==="value"&&i){if(i&&v(i)===undefined){i=n;e.setCustomValidity("Invalid input")}else{e.setCustomValidity("");n=i}}t.call(this,r,i)};e.addEventListener("input",t=>{if(t.target.value&&v(t.target.value)===undefined){e.setCustomValidity("Invalid input");e.value=n;t.preventDefault();return false}e.setCustomValidity("");n=t.target.value})}});if(f){E.forEach(e=>e.addEventListener("change",t=>!e.validity.valid||w(e.name)(t),false))}Object.defineProperty(e,"render",{enumerable:false,configurable:true,writable:true,value:y});Object.defineProperty(e,"linkModel",{enumerable:false,configurable:true,writable:true,value:w});return e},v=(e,t=v.options)=>{e=t.coerce.reduce((e,t)=>t(e),e);if(t.accept.some(t=>t(e)))return e;if(t.reject.some(t=>t(e)))return;if(Array.isArray(e)){e.forEach((t,n)=>e[n]=v(e));return e}if(e&&typeof e==="object"){for(let t in e){const n=v(e[t]);if(typeof n==="undefined"){delete e[t]}else{e[t]=n}}return e}if(typeof e==="string"){e=t.escape.reduce((e,t)=>t(e),e);if(t.eval){try{return v(Function("return "+e).call(null))}catch(t){return e}}}return e},E=(e=window,t=(()=>""))=>{if(typeof window!=="undefined"&&window.prompt&&e===window){const e=window.prompt.bind(window);window.prompt=function(t){const n=e(t),r=v(n);if(typeof r=="undefined"){window.alert("Invalid input: "+n)}else{return r}};s=true;return}return e},C={"t-foreach":(e,t,n,r)=>{e.forEach((i,o)=>{r(Object.assign({value:i,index:o,array:e},t),n)});return true},"t-if":(e,t,n,r)=>{if(e){return r(t,n)}}};v.options={coerce:[],accept:[e=>!e||["number","boolean"].includes(typeof e)],reject:[e=>typeof e==="function",e=>typeof e==="string"&&e.match(/<\s*\?\s*.*\s*/),e=>typeof e==="string"&&e.match(/eval|alert|prompt|dialog|void|clean\s*\(/),e=>typeof e==="string"&&e.match(/url\s*\(/),e=>typeof e==="string"&&e.match(/console\.\s*.*\s*\(/),e=>typeof e==="string"&&e.match(/javascript:/),e=>typeof e==="string"&&e.match(/\(\s*.*\s*\)\s*.*\s*=>/),e=>typeof e==="string"&&e.match(/[Ff]unction\s*.*\s*\(\s*.*\s*\)\s*.*\s*\{\s*.*\s*\}\s*.*\s*\)\s*.*\s*\(\s*.*\s*\)/),e=>typeof e==="string"&&e.match(/Function\s*.*\s*\(\s*.*\s*\)\s*/)],escape:[e=>{if(typeof e==="string"&&e[0]==="?"){const t=e.split("&");let n=t.length;return t.reduce((e,t,r)=>{const[i,o]=decodeURIComponent(t).split("="),a=typeof o,s=a!=="undefined"?v(o):v(i);if(typeof s!=="undefined"){e+=(a!=="undefined"?`${i}=${s}`:s)+(r<n-1?"&":"")}else{n--}return e},"?")}return e},e=>{if(typeof e==="string"&&e[0]!=="?"&&typeof r!=="undefined"){const t=r.createElement("div");t.appendChild(r.createTextNode(e));return t.innerHTML}return e}],eval:true};const j={component:m,reactor:p,view:y,router:b,handlers:h,escape:v,protect:E,JSDOM:e,directives:{}};if(typeof module!=="undefined")module.exports=j;if(typeof window!=="undefined")window.tlx=j}).call(this);