(function(){"use strict";var e,t;if(typeof window==="undefined"){e=require("jsdom").JSDOM;t=new e(``).window}else{t=window}var n=t.document;function r(e,t,i,o,s=t){Object.defineProperty(t,"view",{enumerable:false,configurable:true,writable:true,value:s});const a={};if(typeof e==="string"&&t.nodeName==="#text"){const n=f(e,i,o,a);if(t.data!==n)t.data=n;return}if(e.tagName!==t.tagName){!t.parentNode||t.parentNode.replaceChild(v(e),t);return}b(t.attributes).forEach(n=>e.attributes[n.name]!==null||t.removeAttribute(n.name));let l;Object.keys(e.attributes).forEach(c=>{let u=e.attributes[c],d=typeof u;const p=f(c.split(":")[0],i,o,a),h=O[p]||A.directives[p];u=f(u,i,o,a);d=typeof u;if(u==null){t.removeAttribute(c);delete t[c]}else if(["boolean","number","string"].includes(d)){if(u!==t.getAttribute(c)){try{t.setAttribute(c,u)}catch(e){}}}else{const e=g(c);if(u!==t[e])t[e]=u}if(h){while(t.lastChild)t.removeChild(t.lastChild);const d=(i,o)=>{e.children.forEach(e=>{if(typeof e==="string")t.appendChild(new Text(e));else t.appendChild(n.createElement(e.tagName));r(e,t.lastChild,i,o,s)});return t};const p=h(u,i,o,d,{element:t,raw:c,resolved:c.indexOf("${")>=0?f(c,i,o,a):c}),m=typeof p;if(!p){t.parentElement.removeChild(t)}else if(m==="string"){l=true;t.innerHTML=p}else if(m==="object"&&p instanceof HTMLElement){l=true;if(p!==t)t.parentElement.replaceNode(p,t)}}});if(!l){let a=t.childNodes.length-e.children.length;while(a-- >0)!t.lastChild||t.removeChild(t.lastChild);let l=b(t.childNodes,0,e.children.length);if(l.length===0){const n=t.shadowRoot;if(n)l=b(n.childNodes,0,e.children.length)}e.children.forEach((e,a)=>{if(a<l.length){r(e,l[a],i,o,s);return}if(typeof e==="string")t.appendChild(new Text(e));else t.appendChild(n.createElement(e.tagName));r(e,t.lastChild,i,o,s)})}}function i(){}i.prototype=new Function;let o,s;const a=new Map,l=e=>{const t=e.message.indexOf("not defined");if(t>=0){const t=e.message.split(" ")[0];try{return Function(`return ${t}`)()}catch(e){return t}}},c=(e,...t)=>t,f=(e,t,n)=>{if(typeof e==="string"){const r={},i=e.lastIndexOf("${")===0&&e[e.length-1]==="}";while(true){try{e=Function("scope","actions","extras","__interpolate","with(scope.__t_model||{}) { with(scope) { with(actions) { with(extras) { return "+(i?"__interpolate":"")+"`"+e+"`}}}}")(t||{},n||{},r,c);if(i)e=e[0];break}catch(e){const n=l(e);if(!n)throw e;t.__t_model[n];r[n]=""}}}return e},u=(e,t)=>{t=Object.assign(e,t);Object.keys(t).forEach(n=>{if(typeof t[n]==="undefined"){delete e[n];delete t[n]}});return e},d=(e={},t={})=>{Object.keys(e).forEach(n=>{if(e[n]&&typeof e[n]==="object")d(e[n],t[n])});const n=new Proxy(e,{get(e,t){if(o){let n=a.get(e);if(!n){n={};a.set(e,n)}n[t]||(n[t]=new Set);n[t].add(o)}return e[t]},set(e,r,i){const o=t[r]||t["*"],s=e[r];if(s===i)return true;if(o){const e=Array.isArray(o)?o:[o];e.forEach(e=>t[r](s,i,r,n))}e[r]=i;const l=a.get(e);if(l&&l[r]){l[r].forEach(e=>{if(e.parentElement&&e.render)e.render();else l[r].delete(e)})}return true}});return n},p=e=>{return t=>{const n=e[t.type]||e["*"];if(n)n(t)}},h=(e,t={})=>{let{template:r,customElement:o,model:s,attributes:a,actions:l,controller:c,linkModel:f,reactive:p,lifecycle:h={},protect:m}=t;if(r&&o)throw new Error("Component can't take both template and customElement");if(!r&&!o)throw new Error("Component must have a template or customElement");t=Object.assign({lifecycle:{}},t);if(!o){const t=e.split("-").map(e=>`${e[0].toUpperCase()+e.substring(1)}`).join("");o=Function("template",`return class ${t} extends HTMLElement { constructor() { super(); const shadow = this.attachShadow({mode: 'open'}); shadow.innerHTML = template.innerHTML||template; }}`)(r)}o.defaults={model:s,attributes:a,actions:l,controller:c,linkModel:f,reactive:p,lifecycle:h,protect:m};customElements.define(e,o,t.extends?{extends:t.extends}:undefined);const b=new i,w=function(t={}){const r=n.createElement(e),i=Object.assign({controller:c,linkModel:f,lifecycle:h,protect:m,reactive:p},t);i.model=u(JSON.parse(JSON.stringify(s||{})),t.model);if(i.reactive)i.model=d(i.model);i.attributes=u(Object.assign({},a),t.attributes);i.actions=u(Object.assign({},l),t.actions);Object.keys(i.attributes).forEach(e=>{const t=i.attributes[e],n=typeof t;if(t==null)r.removeAttribute(y(e));else if(["boolean","number","string"].includes(n))r.setAttribute(y(e),t);else r[g(e)]=t});if(h.beforeCreate)h.beforeCreate.call(r);A.view(r,i);if(h.created)h.created.call(r);return r};w.constructor=i;Object.setPrototypeOf(w,b);return w},m=e=>{function t(t){Object.defineProperty(t,"stopRoute",{enumerable:false,configurable:true,writable:true,value:function(){this.routeStopped=true}});const n=t.target.href;if(n){const n=t.target,r=n.getAttribute("target")||n.view;let i=n.pathname.substring(1);if(n.protocol==="file:")i=i.substring(i.indexOf(":")+2);for(let n in e){const r=e[n];try{n=Function("return "+n)()}catch(e){}const o=typeof n,s={};if(o==="string"){const e=n.split("/"),t=i.split("/");if(e.length!==t.length)continue;if(!e.every((e,n)=>{if(e[0]===":"){s[e.substring(1)]=t[n];return true}return e===t[n]})){continue}}if(o==="string"||o==="function"&&n(i)||n.match(i)){r.call(t,s);t.preventDefault();if(t.routeStopped)break}}}}Object.defineProperty(t,"add",{enumerable:false,configurable:true,writable:true,value:(t,n)=>e[t]=n});e=Object.assign({},e);return t},b=e=>[].slice.call(e),g=e=>{const t=e.split("-");let n=t.shift(),r=t.shift();while(r){n+=r[0].toUpperCase()+r.substring(1);r=t.shift()}return n},y=e=>{let t="";for(let n=0;n<e.length;n++){const r=e[n];if(n>0&&r===r.toUpperCase())t+="-";t+=r}return t},w=(e,t,n=e.tagName)=>{if(e.nodeName==="#text")return e.textContent;const r={tagName:n,attributes:Object.assign({},t),children:[]};b(e.attributes).forEach(e=>r.attributes[e.name]=e.value);for(const t in e){if(t[0]==="o"&&t[1]==="n"&&typeof e[t]==="function")r.attributes[t]=e[t]}b(e.childNodes).forEach(e=>r.children.push(w(e)));return r},v=e=>{if(typeof e==="string")return new Text(e);const t=n.createElement(e.tagName);Object.keys(e.attributes).forEach(n=>{const r=e.attributes[n];if(r!=null&&typeof r!=="string")t[n]=r;else t.setAttribute(n,r)});e.children.forEach(e=>t.appendChild(v(e)));return t},E=(e,{template:i,model:a={},attributes:l={},actions:c={},controller:f,linkModel:d,lifecycle:p={},protect:h=s}=e.constructor.defaults||{})=>{if(i){const t=typeof i;if(t==="object"){if(i.tagName==="TEMPLATE")i.innerText=i.innerHTML;Object.assign(b(i.attributes).reduce((e,t)=>{e[t.name]=t.value;return e},{}),l);i=i.shadowRoot?i.shadowRoot:i}else{const t=n.createElement(e.tagName),r=new Text(i);if(t.shadowRoot){while(t.shadowRoot.lastChild)t.shadowRoot.removeChild(t.shadowRoot.lastChild);t.shadowRoot.appendChild(r)}else{t.appendChild(r)}i=t}}let m;const g={__t_model:a},y=i&&(i.tagName==="TEMPLATE"||i.tagName==="SCRIPT"&&i.type==="template")?e.tagName:undefined,v=w(i||e,l,y),E=(e,...t)=>{return r=>{const i=e.split(".");let o=i.pop(),s,a=g.__t_model;while(s=i.shift()){a=a[s];if(!a)a[s]={}}a[o]=r.target.value;t.forEach(e=>n.querySelectorAll(e).forEach(e=>!e.render||e.render()))}},C=(t=g,n)=>{if(A.off||!e.parentElement)return;const i=o,s=t===g?g:{__t_model:t};if(n)u(a,t);o=e;if(m&&p.beforeUpdate)p.beforeUpdate.call(e);r(v,e,s,c);o=i;if(m&&p.updated)p.updated.call(e);return e};if(p.beforeMount)p.beforeMount.call(e);if(e.hasAttribute("defer"))e.removeAttribute("defer");else C(g);m=true;if(p.mounted)p.mounted.call(e);if(f){let{handleEvent:t,events:n,options:r=false}=f;if(typeof f==="function")t=f;if(n)n.forEach(n=>e.addEventListener(n,t,r));else{for(const t in e){if(t[0]==="o"&&t[1]==="n")e.addEventListener(t.substring(2),f,r)}}}const O=b(e.querySelectorAll("input"));if([t.HTMLInputElement,t.HTMLSelectElement,t.HTMLTextAreaElement].some(t=>e instanceof t))O.push(e);O.forEach(e=>{if(h||e.hasAttribute("protect")){const t=e.setAttribute;let n=e.getAttribute("value");if(n[0]==="$"&&n[1]==="{"&&n[n.length-1]==="}")n="";e.setAttribute=function(r,i){if((h||this.hasAttribute("protect"))&&r==="value"&&i){if(i&&j(i)===undefined){i=n;e.setCustomValidity("Invalid input")}else{e.setCustomValidity("");n=i}}t.call(this,r,i)};e.addEventListener("input",t=>{if(t.target.value&&j(t.target.value)===undefined){e.setCustomValidity("Invalid input");e.value=n;t.preventDefault();return false}e.setCustomValidity("");n=t.target.value})}});if(d)O.forEach(e=>e.addEventListener("change",t=>!e.validity.valid||E(e.name)(t),false));Object.entries({render:C,linkModel:E,model:a}).forEach(([t,n])=>Object.defineProperty(e,t,{enumerable:false,configurable:true,writable:true,value:n}));return e},j=(e,t=j.options)=>{e=t.coerce.reduce((e,t)=>t(e),e);if(t.accept.some(t=>t(e)))return e;if(t.reject.some(t=>t(e)))return;if(Array.isArray(e)){e.forEach((t,n)=>e[n]=j(e));return e}if(e&&typeof e==="object"){for(let t in e){const n=j(e[t]);if(typeof n==="undefined")delete e[t];else e[t]=n}return e}if(typeof e==="string"){e=t.escape.reduce((e,t)=>t(e),e);if(t.eval){try{return j(Function("return "+e).call(null))}catch(t){return e}}}return e},C=(e=window,t=(()=>""))=>{if(typeof window!=="undefined"&&window.prompt&&e===window){const e=window.prompt.bind(window);window.prompt=function(t){const n=e(t),r=j(n);if(typeof r=="undefined")window.alert("Invalid input: "+n);else return r};s=true;return}return e},O={"t-for":(e,t,n,r,{raw:i,resolved:o,element:s}={})=>{let[a,l,c]=o.split(":");if(!c)c=Array.isArray(e)?"of":"in";if(c==="in")for(let n in e)r(Object.assign({},t,{[l]:n}));else if(c==="of")for(let n of e)r(Object.assign({},t,{[l]:n}));else throw new TypeError(`loop type must be 'in' or 'of' for ${i}`);return s},"t-foreach":(e,t,n,r,{element:i}={})=>{if(Array.isArray(e))e.forEach((i,o)=>r(Object.assign(t,{value:i,index:o,array:e}),n));return i},"t-forvalues":(e,t,n,r,{element:i}={})=>{if(e&&typeof e==="object")Object.entries(e).forEach(([i,o],s)=>r(Object.assign(t,{value:o,key:i,object:e}),n));return i},"t-if":(e,t,n,r)=>e?r(t,n):undefined};j.options={coerce:[],accept:[e=>!e||["number","boolean"].includes(typeof e)],reject:[e=>typeof e==="function",e=>typeof e==="string"&&e.match(/<\s*\?\s*.*\s*/),e=>typeof e==="string"&&e.match(/eval|alert|prompt|dialog|void|clean\s*\(/),e=>typeof e==="string"&&e.match(/url\s*\(/),e=>typeof e==="string"&&e.match(/console\.\s*.*\s*\(/),e=>typeof e==="string"&&e.match(/javascript:/),e=>typeof e==="string"&&e.match(/\(\s*.*\s*\)\s*.*\s*=>/),e=>typeof e==="string"&&e.match(/[Ff]unction\s*.*\s*\(\s*.*\s*\)\s*.*\s*\{\s*.*\s*\}\s*.*\s*\)\s*.*\s*\(\s*.*\s*\)/),e=>typeof e==="string"&&e.match(/Function\s*.*\s*\(\s*.*\s*\)\s*/)],escape:[e=>{if(typeof e==="string"&&e[0]==="?"){const t=e.split("&");let n=t.length;return t.reduce((e,t,r)=>{const[i,o]=decodeURIComponent(t).split("="),s=typeof o,a=s!=="undefined"?j(o):j(i);if(typeof a!=="undefined")e+=(s!=="undefined"?`${i}=${a}`:a)+(r<n-1?"&":"");else n--;return e},"?")}return e},e=>{if(typeof e==="string"&&e[0]!=="?"&&typeof n!=="undefined"){const t=n.createElement("div");t.appendChild(n.createTextNode(e));return t.innerHTML}return e}],eval:true};const A={component:h,reactor:d,view:E,router:m,handlers:p,escape:j,protect:C,resolve:f,JSDOM:e,directives:{}};if(typeof module!=="undefined")module.exports=A;if(typeof window!=="undefined")window.tlx=A}).call(this);