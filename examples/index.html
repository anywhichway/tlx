<html>
<head>
<script src="../src/tlx-core.js"></script>
<script src="../src/tlx-component.js"></script>
<script src="../src/tlx-reactive.js"></script>
<script src="../src/tlx-template.js"></script>
<script>

const ToDo = function({title="",listid="",done=false},el = document.createElement(tlx.getTagName(ToDo))) {
	Object.assign(el,tlx.Mixin);
	const innerHTML = el.innerHTML;
	el.initialize({title,listid,done,...arguments[0]});
	el.remove = () => {
		el.parentElement.removeChild(el);
	}
	el.render = (attributes) => el.innerHTML = el.resolve(`
		${innerHTML}<li id="\${id}">\${title} <input type="checkbox" \${(done ? "checked" : "")} onclick="(()=>{ \${listid||id}.remove('\${id}')})()"></li>
	`,attributes);
	return el;
}
tlx.register("todo",ToDo);

const ToDoList = function({title="",todos=[]},el = document.createElement(tlx.getTagName(ToDoList))) {
	const genId = () => "tid" + (Math.random()+"").substring(2); // not a great id generator, but fine for demo
	Object.assign(el,tlx.Mixin);
	const innerHTML = el.innerHTML;
	el.initialize({title,todos,...arguments[0]});
	el.todos.forEach(todo => todo.id || (todo.id = genId())); 
	el.add = () => {
		const title = prompt("ToDo Name");
		if(title) {
			el.todos.push({title,id:genId()});
			el.render();
		}
	}
	el.remove = (id) => {
		const i = el.todos.findIndex((item) => item.id===id);
		if(i>=0) {
			el.todos.splice(i,1);
			el.render();
		}
	}
	el.render = (attributes) => el.innerHTML = el.resolve(`
			<p>\${title}</p>
			${innerHTML}
			<button onclick="\${id}.add()">Add Task</button>
			<ul>
			\${el.todos.reduce((accum,todo) => accum += ToDo(todo).render({listid:el.id}),"")}
			</ul>
	`,attributes);
	return el;
}
tlx.register("todolist",ToDoList);


tlx.enable();
</script>

<template t-tagname="x-todo" title="Untitled Tasks">
	<h3 onclick="${id}.changeTitle(event)">${title}</h3>
  	<ul onclick="${id}.addTask()" >${tasks.reduce((accum,item) => accum += (`<li>${item}</li>`),"")}</ul>
	<style>
		h3 { font-size: 120% }
		font-style: italic;
	</style>
  
	<script>
		//this.state.name = "Test Name"
		this.tasks = ["Task One"];
		this.addTask = function() { 
			this.tasks.push(prompt("Task Name:")); 
			this.render();
		};
		this.changeTitle = function(event) { 
			const title = prompt("New Title:");
			if(title) {
				this.setAttribute("title",title);
			}
			event.stopPropagation();
		}
	</script>
</template>
</head>
<body>

<todo state="${{name:'Joe',age:27}}" id="one" value="one" done="true" ><b>${state.age}</b></todo>

<todolist title="My Tasks" todos="${[{title:'Task One'}]}"></todolist>

<script>
const todos = ToDoList({todos:[{title:"one"}]})
console.log(todos+"")
</script>

<script>
setTimeout(() => {
	const el = document.getElementById("one"),
		state = el.getAttribute("state");
	state.age = 30;
});
</script>

<x-todo id="mytodos" title="My Tasks"></x-todo>


</body>
</html>