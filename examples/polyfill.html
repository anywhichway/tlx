<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8"/>
<script src="../src/tlx-vtdom.js"></script>
<script src="../src/tlx-sanitize.js"></script>
<script src="../src/tlx-component.js"></script>
<script src="../src/tlx-polyfill.js"></script>
<script>tlx.polyfill(true)</script>

<script>
class XTodo extends HTMLElement {
	constructor() { 
		super(tlx.getTagName(XTodo));
		// If the polyfill if being used, then super creates a native element and assigns it to el.
		// The property '__el__' should be used as a replacement for 'this', if it exists, and returned.
		const el = this.__el__ || this,
			vnode = el.vNode();
		
		// Define tasks local to the instance
		vnode.tasks = ["Task One"];
		
		vnode.addTask = function(event) {
			event.stopPropagation();
			const task = prompt("Task Name:");
			if(task) {
				this.tasks.push(task);
				this.render();
			} 
		}
		vnode.buildList = function() {
			return this.tasks.reduce((accum,item) => accum += `<li>${item}</li>`,"");
		}
		vnode.changeTitle = function(event) {
			event.stopPropagation();
			const title = prompt("New Title:");
			if(title) {
				this.attributes.title = title;
				this.render();
			}
		}
		vnode.render = function(attributes) {
			this.html(`<h3 onclick="\${id}.changeTitle(event)">\${title}</h3><ul onclick="\${id}.addTask(event)">\${buildList()}</ul>`, Object.assign({title:"My Tasks"},this.attributes,attributes));
		}
		vnode.connectedCallback = function() {
			console.log("Connected");
		}
		vnode.attributeChangedCallback = function(name,oldValue,newValue) {
			console.log(arguments);
		}
		return el;
	}
	static get observedAttributes() { return ["title"]; }
}
customElements.define("x-todo",XTodo);

</script>

</head>
<body>

<x-todo id="mytodos" title="My Tasks"></x-todo>

</body>
</html>